/**
 * Copyright (c) 2018-present, A2 Re≈°itve d.o.o.
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in
 * compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License is
 * distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See
 * the License for the specific language governing permissions and limitations under the License.
 */

package solutions.a2.cdc.oracle.internals;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertFalse;
import static org.junit.jupiter.api.Assertions.assertTrue;
import static solutions.a2.cdc.oracle.OraCdcTransaction.LobProcessingStatus.REDOMINER;
import static solutions.a2.cdc.oracle.OraCdcV$LogmnrContents.UPDATE;
import static solutions.a2.cdc.oracle.internals.OraCdcChange._11_5_URP;
import static solutions.a2.cdc.oracle.internals.OraCdcChange._11_16_LMN;
import static solutions.a2.oracle.utils.BinaryUtils.hexToRaw;

import java.io.IOException;
import java.nio.file.Path;
import java.sql.SQLException;
import java.time.ZoneId;

import org.apache.commons.lang3.StringUtils;
import org.apache.commons.lang3.Strings;
import org.junit.jupiter.api.Test;

import solutions.a2.cdc.oracle.OraCdcLobExtras;
import solutions.a2.cdc.oracle.OraCdcRawTransaction;
import solutions.a2.cdc.oracle.OraCdcRedoMinerStatement;
import solutions.a2.cdc.oracle.OraCdcTransactionArrayList;
import solutions.a2.oracle.internals.Xid;

/**
 *  
 * @author <a href="mailto:averemee@a2.solutions">Aleksei Veremeev</a>
 * 
 */
public class Ops_URP_LMN_BindingTest extends TestWithOutput {

	@Test
	public void test() {

		var orl = OraCdcRedoLog.getLinux19c();

		var baUpdate1 = hexToRaw("B40400000100060D26CD389602000096000000000000FFFF050172000500FFFF296F420126CD3896060D00000100FFFF0000000000000000CC001400180010001D00020001001400B800B80004000200020003000200040001000700070003000000000003000300040004000000050005000500020002000200020001000300030000000600040003000400020002000200020002000200020000000100010002000300030002000300070003000100020002000200020002000100000002000400020002000200020002000100020002000100020002000000000001000000000000000000010002000000030001000100000000000200020002000200020006000000F003FA1922000000310014001CF0E100024807005B6143045B61430406000000000000000B01140600001CF0020D000000000000296F420102480600EB03EC03EA03EC03FA122501020000002C02000000005C01F4FF00000000A0002D0004015800000001585C0010002E002E00000000100000000200000100020003000400050006000700080009000A000B000C000D000E000F0010001100120013001400150016001700180019001A001B001C001D001E001F0020002100220023002400250026002700280029002A002B002C002D002F0030003100320033003400350036003700380039003A003B003C003D003E003F0040004100420043004400450046004700480049004A004B004C004D004E004F0050005100520053005400550056005700580059005A005B005C005D000400020002000300020004000100070007000300FFFFFFFF0300030004000400FFFF0500050005000200020002000200010003000300FFFF06000400030004000200020002000200020002000200FFFF0100010002000300030002000300070003000100020002000200020002000100FFFF0200040002000200020002000200010002000200010002000200FFFFFFFF0100FFFFFFFFFFFFFFFF01000200FFFF030001000100FFFFFFFF020002000200020002000600FFFFC30B0108C1110000C10200003E596600C10500003733303380000000787B04140F3433007872011501010100C2224C00C2081B00C2075000C30D245B37333033554E444546000000554E444546000000554E444546000000C1020000C1150000C3150000C102000080000000C15C2B00C1613F0030303033334601004E4F4E45414654004E4F434CC1020000C1020000C1070100C1020000C1020100C1020000C1100100800014008004341FC107F357C24A04003E646600C1050200C2050404787B04140F3433003E64660080011801C102D44EC10201E9C102001EC1024101C10201008016B200C102A000C3411807C1090000C10B7900C102C7C7C1020034C102F2FF80070000C1031FFFC102E7FF80FFFFFFC1021800C1027F808000010080000300C1020500535444008000090080000B00C1020D00C1020F00C1021100C1021300C1021500C505010B010819000B05010006004304EB03EC0326CD3896060D000001005B610000000000000000100010001D0008000100010001000300020D38960080060D296F420102480700EB03EC03EA03EC03FA120501020000002C020000000063040C000000000049002D005C006100620059004F0080005100010053003E646600");
		OraCdcRedoRecord rrUpdate1 = new OraCdcRedoRecord(orl, 0x00000d069638cd26l, "0x026f56.0045d463.0054", baUpdate1);
		assertTrue(rrUpdate1.has5_1());
		assertFalse(rrUpdate1.has10_x());
		assertTrue(rrUpdate1.has11_x());
		assertEquals(rrUpdate1.change11_x().operation, _11_5_URP);

		var ba_11_16Lmn1 = hexToRaw("280100000100060D26CD3896030000000000000000006100050172000500FFFF296F420126CD3896060D00000200FFFF0000000000000000140014001800100010001C0004000400010003007800081622000000310014001CF0E100024808BC5B6143045B61430406000000000000000B01140700001CF0020D8E9009000000296F420102480700EB03EC03EA03EC03FA123001020000000144020010000000000000000014000000020000EB03EC03000000005D006300010003008000B5003E6466000B10010006004304EB03EC0326CD3896060D000002005B6100000000000000000800100010001C00020D010001000300296F420102480800EB03EC03EA03EC03FA12100102000000015C000010000000000000000014000000020000EB03EC0300000000"); 
		var rr_11_16Lmn1 = new OraCdcRedoRecord(orl, 0x00000d069638cd26l, "0x026f56.0045d465.0128", ba_11_16Lmn1);
		assertTrue(rr_11_16Lmn1.has5_1());
		assertFalse(rr_11_16Lmn1.has10_x());
		assertTrue(rr_11_16Lmn1.has11_x());
		assertEquals(rr_11_16Lmn1.change11_x().operation, _11_16_LMN);

		var baUpdate2 = hexToRaw("B8040000017D060D8CCE3896020000000000000000000100050172000500FFFF296F42018CCE3896060D00000100FFFF0000000000000000CC001400180010001D00020001001400B800B8000400020002000300020004000100070007000300000000000300030003000A000000050005000500020002000200020001000200030000000100040003000400020002000200020002000200020000000100010002000300030002000300070003000200010002000200020002000100000002000400020002000200020002000100020002000100020002000000000001000000000000000000020002000000030001000100000000000200020002000200020006000000F403301522000000310014001CF0E10002480ABD5B6143045B61430406000000000000000B01140900001CF0020D000000000000296F420102480900EB03EC03EA03EC03FA122501020000002C028B0001005C01F4FF0000000000002D0000005800000001585C0010002E002E00000000100000000200000100020003000400050006000700080009000A000B000C000D000E000F0010001100120013001400150016001700180019001A001B001C001D001E001F0020002100220023002400250026002700280029002A002B002C002D002F0030003100320033003400350036003700380039003A003B003C003D003E003F0040004100420043004400450046004700480049004A004B004C004D004E004F0050005100520053005400550056005700580059005A005B005C005D000400020002000300020004000100070007000300FFFFFFFF0300030003000A00FFFF0500050005000200020002000200010002000300FFFF01000400030004000200020002000200020002000200FFFF0100010002000300030002000300070003000200010002000200020002000100FFFF0200040002000200020002000200010002000200010002000200FFFFFFFF0100FFFFFFFFFFFFFFFF02000200FFFF030001000100FFFFFFFF020002000200020002000600FFFFC315010CC1380300C10205003E596600C10509003735303780000D0078730601072505007872011501010100C2056000C20F1300C2054500C2086100333030303030383638392300554E444546002700554E444546002B00554E444546002F00C1023100C1033300C2333500C202370080003900C1523B00C157160030003F0041545356414654004E4F434CC1024700C1024900C1074B00C1024D00C1024F00C1025100C11053008000550080005700C1075900C24C0800C2031900C1055F00C2063B007873060107250500C2031900C102690080006B00C1026D00C1026F00C1027100C102730080007500C1027700C3195B0FC10A7B00C1067D00C1027F00C1028100C102830080008500C1038700C102890080008B00C1028D00C1028F0080009100C1029300C1029500535444008000990080009B00C1029D00C1029F00C102A100C102A300C102A500C5050115010CA9000B05010006004304EB03EC038CCE3896060D000001005B610000000000000000100010001D0008000100010001000300020D38960080060D296F420102480A00EB03EC03EA03EC03FA120501020000002C028B00010063040C000000000501002D005C00610062005900000080020400010000003E646600");
		var rrUpdate2 = new OraCdcRedoRecord(orl, 0x00000d069638ce8cl, "0x026f56.0045d6af.0130", baUpdate2);
		assertTrue(rrUpdate2.has5_1());
		assertFalse(rrUpdate2.has10_x());
		assertTrue(rrUpdate2.has11_x());
		assertEquals(rrUpdate2.change11_x().operation, _11_5_URP);

		var ba_11_16Lmn2 = hexToRaw("280100000100060D8CCE3896030000000000000000000000050172000500FFFF296F42018CCE3896060D00000200FFFF0000000000000000140014001800100010001C00040004000100030078003A1122000000310014001CF0E10002480BC25B6143045B61430406000000000000000B01140A00001CF0020D8E9009000000296F420102480A00EB03EC03EA03EC03FA123001020000000144020010000000000000000014000000020000EB03EC03010000005D00630001000300800000003E6466000B10010006004304EB03EC038CCE3896060D000002005B6100000000000000000800100010001C00020D010001000300296F420102480B00EB03EC03EA03EC03FA12100102000000015C000010000000000000000014000000020000EB03EC0301000000"); 
		var rr_11_16Lmn2 = new OraCdcRedoRecord(orl, 0x00000d069638ce8cl, "0x026f56.0045d6b2.0018", ba_11_16Lmn2);
		assertTrue(rr_11_16Lmn2.has5_1());
		assertFalse(rr_11_16Lmn2.has10_x());
		assertTrue(rr_11_16Lmn2.has11_x());
		assertEquals(rr_11_16Lmn2.change11_x().operation, _11_16_LMN);

		var raw = new OraCdcRawTransaction(new Xid((short)0x31, (short)0x14, 0xe1f01c), ZoneId.systemDefault(), 0x10, new OraCdcLobExtras());
		try {
			raw.add(rrUpdate1, (int)(System.currentTimeMillis() / 1000));
			raw.add(rr_11_16Lmn1, (int)(System.currentTimeMillis() / 1000));
			raw.add(rrUpdate2, (int)(System.currentTimeMillis() / 1000));
			raw.add(rr_11_16Lmn2, (int)(System.currentTimeMillis() / 1000));
			raw.commitScn(0xd0696390dd8l);
			var transaction = new OraCdcTransactionArrayList(raw, orl.cdb(), REDOMINER, Path.of(System.getProperty("java.io.tmpdir")));
			var stmt = new OraCdcRedoMinerStatement();

			assertTrue(transaction.completed());

			assertTrue(transaction.getStatement(stmt));
			assertEquals(stmt.getOperation(), UPDATE);
			assertEquals(stmt.getRba(), rrUpdate1.rba());
			assertEquals(stmt.getRowId().toString(), "AEQ2FbAAPAALAPrAAA");
			assertTrue(Strings.CS.contains(stmt.toString(), "\"COL 46\" = '59'"));
			assertTrue(Strings.CS.contains(stmt.toString(), "\"COL 93\" = '80'"));
			assertTrue(Strings.CS.contains(stmt.toString(), "\"COL 99\" = '3e6466'"));
			assertTrue(Strings.CS.contains(
					StringUtils.substringAfter(stmt.toString(), " where "),
					"\"COL 46\" = '58'"));
			System.out.println(stmt);

			assertTrue(transaction.getStatement(stmt));
			assertEquals(stmt.getOperation(), UPDATE);
			assertEquals(stmt.getRba(), rrUpdate2.rba());
			assertEquals(stmt.getRowId().toString(), "AEQ2FbAAPAALAPrAAB");
			assertTrue(Strings.CS.contains(stmt.toString(), "\"COL 46\" = '59'"));
			assertTrue(Strings.CS.contains(stmt.toString(), "\"COL 93\" = '80'"));
			assertTrue(Strings.CS.contains(stmt.toString(), "\"COL 99\" = '3e6466'"));
			assertTrue(Strings.CS.contains(
					StringUtils.substringAfter(stmt.toString(), " where "),
					"\"COL 46\" = '58'"));
			System.out.println(stmt);

		} catch(IOException | SQLException e) {}
	}

	@Test
	public void testRaInterfaceLinesAll_1() {

		var orl = OraCdcRedoLog.getLinux19c();

		var baUpdate1 = hexToRaw("9404000001138D0543B24CD21A00000007D7CD51000000000501A4001500FFFF1D47410343B24CD28D0500001500FFFF0300000000000000C8001400180010001D00020000001C00B400B40000000B000700120008000C0001000800010006000F000300040052000300030000000300000003000000000003000000030000000000000003000000030000000000000003000000000000000000000000000000000000000000000004000000020000000000000000000000000002000200040004000000000000000000000000000000000000000000000000000000000007000D0004000C00000000000000000000000000000003000700010007000B000000E003B20A220000004A000300B64E2E007B3039211F9B02001F9B020007000000000000000B0103380000B64E020D0000000000001C4741037B300900F30001043203C0037D0925010B000000280B000001005B01FAFF0100000004003D00070001085A0009003E003E0000000010000000000000F3000104010000000100020003000400050006000700080009000A000B000C000D000E000F0010001100120013001400150016001700180019001A001B001C001D001E001F0020002100220023002400250026002700280029002A002B002C002D002E002F0030003100320033003400350036003700380039003A003B003C003D003F0040004100420043004400450046004700480049004A004B004C004D004E004F0050005100520053005400550056005700580059005A005B00FFFF0B000700120008000C0001000800010006000F0003000400520003000300FFFF0300FFFF0300FFFFFFFF0300FFFF0300FFFFFFFFFFFF0300FFFF0300FFFFFFFFFFFF0300FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0400FFFF0200FFFFFFFFFFFFFFFFFFFFFFFF0200020004000400FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF07000D0004000C00FFFFFFFFFFFFFFFFFFFFFFFFFFFF03000700010007000B00FFFF4F5244455220454E5452590031373534303137FF4f52444552204f52444552204f5244455220000031393439303930313132313132303633373530313000060032353933343938323000130034333636373007004f52444552204f52444552204f524400C21516064C494E454f52444552204f52444552204f52444552204f52444552204f52444552204f52444552204f52444552204f52444552204f52444552204f52444552204f52444552204f52444552204f52444552204f524445000045555200C2160200C20B0A10C20B08D2C20C1400C20F27DAC20C1400C20F1500C20C140055736572C1020700C1150000C1150000C2020606C2020606787D0B170A0F1C10435553544F4D45522053495445002C02534149413132313132303633373530313E626617313735343031370032D78D05787D0B11010101004F5244455220454E545259010B0501001A000200F30001043DB24CD28D05000009001F9B03000000000000000A0010001D00020006000000020D0700000000001D4741037B303900F30001043203C0037D0905010B000000280B000001005B0106000000000067C03D000000C5022D505F514515");
		var rrUpdate1 = new OraCdcRedoRecord(orl, 0x0000058dd24cb243l, "0x0042a3.007a7bc9.013c", baUpdate1);
		assertTrue(rrUpdate1.has5_1());
		assertFalse(rrUpdate1.has10_x());
		assertTrue(rrUpdate1.has11_x());
		assertEquals(rrUpdate1.change11_x().operation, _11_5_URP);

		var ba_11_16Lmn1 = hexToRaw("2C08000001008D0543B24CD21B00000007D7CD51000018000502A3001500FFFF080E42033FB24CD28D0500000100FFFF03000000000000000400200003000000000000001F4741037B3001000A003807FF7F000000000000000000000501A4001500FFFF1F47410343B24CD28D0500000101FFFF0300000000000000100214001800100010001C00000200020A000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000900000004000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000030001001E001E001E000000090000000000000000000000010000000000000000000100070001000700000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000700050000003807D0060A0000004A000300B64E2E007B3001001F9B02001F9B0200070000001D4741030B0103000000B64E020D0000000000001D4741037B303900F30001043203C0037D0930010B0000000144000109000000000000000010000040000000F3000104010000005C005D005E005F0060006100620063006400650066006700680069006A006B006C006D006E006F0070007100720073007400750076007700780079007A007B007C007D007E007F0080008100820083008400850086008700880089008A008B008C008D008E008F0090009100920093009400950096009700980099009A009B009C009D009E009F00A000A100A200A300A400A500A600A700A800A900AA00AB00AC00AD00AE00AF00B000B100B200B300B400B500B600B700B800B900BA00BB00BC00BD00BE00BF00C000C100C200C300C400C500C600C700C800C900CA00CB00CC00CD00CE00CF00D000D100D200D300D400D500D600D700D800D900DA00DB00DC00DD00DE00DF00E000E100E200E300E400E500E600E700E800E900EA00EB00EC00ED00EE00EF00F000F100F200F300F400F500F600F700F800F900FA00FB00FC00FD00FE00FF0000010101020103010401050106010701080109010A010B010C010D010E010F0110011101120113011401150116011701180119011A011B011C011D011E011F0120012101220123012401250126012701280129012A012B012C012D012E012F0130013101320133013401350136013701380139013A013B013C013D013E013F0140014101420143014401450146014701480149014A014B014C014D014E014F0150015101520153015401550156015701580159015A015B010A00FFFFFFFFFFFFFFFFFFFFFFFF0500FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0900FFFF0400FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0200FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF030001001E001E001E00FFFF0900FFFFFFFFFFFFFFFFFFFF0100FFFFFFFFFFFFFFFF0100070001000700FFFFFFFFFFFF0200FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0300FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF020007000500FFFF31373334313230393637FFFFC4044C1E5700000034383335323436313300040030303230454106003236311930000000202020202020202020202020202020202020202020202020202020202031130D20202020202020202020202020202020202020202020202020202020203025012020202020202020202020202020202020202020202020202020202020300B173939303031393631380018005300000080100000787D0B170A11380080000200787D0B170A1138D2C1540000C2033EDAC1020000787D0B1106270500C41A5E32530007000B1001001A000200F300010443B24CD28D05000001001F9B03000000000000000800100010001C00020D0000040000001F4741037B300100F30001043203C0037D0910010B0000000144000009000000000000000010000040000000F300010401000000"); 
		var rr_11_16Lmn1 = new OraCdcRedoRecord(orl, 0x0000058dd24cb243l, "0x0042a3.007a7bcc.0010", ba_11_16Lmn1);
		assertTrue(rr_11_16Lmn1.has5_1());
		assertFalse(rr_11_16Lmn1.has10_x());
		assertTrue(rr_11_16Lmn1.has11_x());
		assertEquals(rr_11_16Lmn1.change11_x().operation, _11_16_LMN);

		var raw = new OraCdcRawTransaction(new Xid((short)0x4a, (short)0x3, 0x2e4eb6), ZoneId.systemDefault(), 0x10, new OraCdcLobExtras());
		try {
			raw.add(rrUpdate1, (int)(System.currentTimeMillis() / 1000));
			raw.add(rr_11_16Lmn1, (int)(System.currentTimeMillis() / 1000));
			raw.commitScn(0x0000058dd24cb255l);
			var transaction = new OraCdcTransactionArrayList(raw, orl.cdb(), REDOMINER, Path.of(System.getProperty("java.io.tmpdir")));
			var stmt = new OraCdcRedoMinerStatement();

			assertTrue(transaction.completed());

			assertTrue(transaction.getStatement(stmt));
			assertEquals(stmt.getOperation(), UPDATE);
			assertEquals(stmt.getRba(), rrUpdate1.rba());
			assertEquals(stmt.getRowId().toString(), "AAApsfAAQAAAQDzAAB");

			System.out.println(stmt);

		} catch(IOException | SQLException e) {}	
	}

	@Test
	public void testRaInterfaceLinesAll_2() {

		var orl = OraCdcRedoLog.getLinux19c();

		var baUpdate1 = hexToRaw("D404000001008D0545E67CD93B02000007D7CD51000002000502C5001500FFFFD8B65B0345E67CD98D0500007200FFFF03000000000000000400200002000F5400000000C97083154C5401000A00DC030000000000000000000000000501C6005600FFFFC970831545E67CD98D0500000101FFFF0300000000000000C8001400180010001D00020000001C00B400B40005000B00070012000800060001000800010006000F00030004002F000300040000000300000003000000000004000000030000000000000004000000030000000000000004000000000000000000000000000000000000000000000004000000020005000700000000000200020002000300030000000000060000000000000000000000000000000000000000000000000007000D0006000600000000000000000000000000000003000700010007000B000000DC0344020A0000005B00020089F336004C5401C31F9B02001F9B020007000000C87083150B010200000089F3020D000000000000C87083154C540500FF0001043203C0037D092501070000002807000011005B01F9FF010000CA7CD93200000001085A0009003300330000000010000000000000FF000104110000000100020003000400050006000700080009000A000B000C000D000E000F0010001100120013001400150016001700180019001A001B001C001D001E001F0020002100220023002400250026002700280029002A002B002C002D002E002F003000310032003400350036003700380039003A003B003C003D003E003F0040004100420043004400450046004700480049004A004B004C004D004E004F0050005100520053005400550056005700580059005A005B0005000B00070012000800060001000800010006000F00030004002F0003000400FFFF0300FFFF0300FFFFFFFF0400FFFF0300FFFFFFFFFFFF0400FFFF0300FFFFFFFFFFFF0400FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0400FFFF020005000700FFFFFFFF02000200020003000300FFFFFFFF0600FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF07000D0006000600FFFFFFFFFFFFFFFFFFFFFFFFFFFF03000700010007000B00FFFFC40D622F350000004F5244455220454E5452590031373535343333004f52444552204f52444552204f524445522000003139363338393939323237323331B60830CA7CD932363131323231353000000034333735353810004f52444552204f52444552204f524400C21516174C494E454f52444552204f52444552204f52444552204f52444552204f52444552204f52444552204f52444552204f5244455205555344D9C20C5B29C20B0A51C20B3EC1C307295DC23E45FFC307295DC23E49D9C307295D55736572C1020000C40C206421001400787D0B1C01010100C1071400C111F211C1110000C14B2900C14B2900C5022D62254C0200787D0B1C01010100435553544F4D455220534954450D0000434852434F4E4517323237323331B6083E626608313735353433330036000000787D0B19010101004F5244455220454E545259240B0501001A000200FF00010445E67CD98D05000010001F9B03000000000000000A0010001D00020007001000020D000000000000C97083154C540100FF0001043203C0037D090501070000002807000011005B01070000000009050132000000787D0B1C01010101");
		var rrUpdate1 = new OraCdcRedoRecord(orl, 0x0000058dd97ce645l, "0x0042c9.007145cd.01e8", baUpdate1);
		assertTrue(rrUpdate1.has5_1());
		assertTrue(rrUpdate1.change5_1().supplementalLogData());
		assertTrue(rrUpdate1.change5_1().supplementalFb() != 0);
		assertTrue(rrUpdate1.change5_1().fb() != 0);
		assertFalse(rrUpdate1.has10_x());
		assertTrue(rrUpdate1.has11_x());
		assertEquals(rrUpdate1.change11_x().operation, _11_5_URP);
		assertTrue(rrUpdate1.change11_x().fb() != 0);

		var baUpdate2 = hexToRaw("F8070000010D8D0545E67CD93C02000007D7CD5100008D050501C6005600FFFFC970831545E67CD98D0500000200FFFF030000000000000012021400180010001D00020000001C00FE01FE0107000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000030001001E001E001E000000060000000000000000000000010000000000000000000100070004000700060000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020007000500000000004407F81B220000005B00020089F336004C5402C31F9B02001F9B020007000000000000000B010201000089F3020D000000000000C97083154C540100FF0001043203C0037D09250107000000040000001000FF01FFFF010000000000C2001B000144FF0009001E011E0100000010000000000000FF000104110000005C005D005E005F0060006100620063006400650066006700680069006A006B006C006D006E006F0070007100720073007400750076007700780079007A007B007C007D007E007F0080008100820083008400850086008700880089008A008B008C008D008E008F0090009100920093009400950096009700980099009A009B009C009D009E009F00A000A100A200A300A400A500A600A700A800A900AA00AB00AC00AD00AE00AF00B000B100B200B300B400B500B600B700B800B900BA00BB00BC00BD00BE00BF00C000C100C200C300C400C500C600C700C800C900CA00CB00CC00CD00CE00CF00D000D100D200D300D400D500D600D700D800D900DA00DB00DC00DD00DE00DF00E000E100E200E300E400E500E600E700E800E900EA00EB00EC00ED00EE00EF00F000F100F200F300F400F500F600F700F800F900FA00FB00FC00FD00FE00FF0000010101020103010401050106010701080109010A010B010C010D010E010F0110011101120113011401150116011701180119011A011B011C011D011F0120012101220123012401250126012701280129012A012B012C012D012E012F0130013101320133013401350136013701380139013A013B013C013D013E013F0140014101420143014401450146014701480149014A014B014C014D014E014F0150015101520153015401550156015701580159015A015B017CD90700FFFFFFFFFFFFFFFFFFFFFFFF0500FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0500FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0200FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF030001001E001E001E00FFFF0600FFFFFFFFFFFFFFFFFFFF0100FFFFFFFFFFFFFFFF01000700040007000600FFFFFFFF0200FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0300FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF020007000500FFFFC4083835333834303700C402634D20000B01333138383442495A434150523236310030010000202020202020202020202020202020202020202020202020202020202031451720202020202020202020202020202020202020202020202020202020203002002020202020202020202020202020202020202020202020202020202020300200373935323231000053011B258000245F787D0B1C0C113C00C3023750787D0B1C182E0908C5023011611A2501C1540000C2033E00C1020B01787D0B190A390215C41B0C1710B4570A0B0501001A000200FF00010445E67CD98D05000011001F9B03000000000000000A0010001D00020001001000020D000000000000C97083154C540200FF0001043203C0037D09050107000000040700001000FF010100000000090501C200000059040000");
		var rrUpdate2 = new OraCdcRedoRecord(orl, 0x0000058dd97ce645l, "0x0042c9.007145d0.00ec", baUpdate2);
		assertTrue(rrUpdate2.has5_1());
		assertTrue(rrUpdate2.change5_1().supplementalLogData());
		assertTrue(rrUpdate2.change5_1().supplementalFb() != 0);
		assertTrue(rrUpdate2.change5_1().fb() != 0);
		assertFalse(rrUpdate2.has10_x());
		assertTrue(rrUpdate2.has11_x());
		assertEquals(rrUpdate2.change11_x().operation, _11_5_URP);
		assertTrue(rrUpdate2.change11_x().fb() != 0);

		assertEquals(rrUpdate1.halfDoneKey(), rrUpdate2.halfDoneKey());

		var baLmn1 = hexToRaw("B804000005018D0554E67CD90100000007D7CD510000451700000100B4090000B40900000A09250154E67CD98D05000051E67CD98D05000066E67CD98D0500008B7D9F480501C6005600FFFFC970831545E67CD98D0500000300FFFF0300000000000000C60014001800100010001C00B600B60005000B00070012000800010001000800010006000F0003000400380003000400000003000000040000000000040000000400000000000000040000000400000000000000040000000000000000000000000000000000000000000000040000000200050007000700000000000200030003000300030000000000060000000000000000000000000000000000000000000000000007000A0010000100000000000000000000000000000003000700010007000B0000000000D803B214220000005B00020089F336004C5403121F9B02001F9B020007000000000000000B010202000089F3020D000000000000347083154C540500D543C1033203C0037D0930010800000001085B00090000000000000000107CD940000000D543C103010000000100020003000400050006000700080009000A000B000C000D000E000F0010001100120013001400150016001700180019001A001B001C001D001E001F0020002100220023002400250026002700280029002A002B002C002D002E002F0030003100320033003400350036003700380039003A003B003C003D003E003F0040004100420043004400450046004700480049004A004B004C004D004E004F0050005100520053005400550056005700580059005A005B00072205000B00070012000800010001000800010006000F0003000400380003000400FFFF0300FFFF0400FFFFFFFF0400FFFF0400FFFFFFFFFFFF0400FFFF0400FFFFFFFFFFFF0400FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0400FFFF0200050007000700FFFFFFFF02000300030003000300FFFFFFFF0600FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF07000A0010000100FFFFFFFFFFFFFFFFFFFFFFFFFFFF03000700010007000B00FFFF0B01C40D622B4B0000004F5244455220454E5452590031373534383331D94f52444552204f52444552204f5244455220FFFF3139353635393030300500003000FFFF32363032383336303000140034333735363402004f52444552204f52444552204f524400C21516004C494E454f52444552204f52444552204f52444552204f52444552204f52444552204f52444552204f52444552204f52444552204f52444552204f5255534400C303065DC20B0A00C3024A02C3105B3EC3093545C3105B3EC33D3F45C3105B3E55736572C1020000C40C206451000200787D0B1C010101D9787D0B1C010101A0C1020000C2145100C2145100C10B2900C10B2900C5022D62254C0000787D0B1C010101005348495020504F494E540501435553544F4D4552205049434B205550300000003E626600313735343833310031028D05787D0B14010101004F5244455220454E545259000B10010019000200D543C10344E67CD98D0500000E001F9B03000000000000000800100010001C00020D000000000000C97083154C540300D543C1033203C0037D0910010800000001080000090000000000000000107CD940000000D543C10301000000");
		var rrLmn1 = new OraCdcRedoRecord(orl, 0x0000058dd97ce654l, "0x0042c9.007145e9.0010", baLmn1);
		assertTrue(rrLmn1.has5_1());
		assertTrue(rrLmn1.change5_1().supplementalLogData());
		assertTrue(rrLmn1.change5_1().supplementalFb() != 0);
		assertTrue(rrLmn1.change5_1().fb() != 0);
		assertFalse(rrLmn1.has10_x());
		assertTrue(rrLmn1.has11_x());
		assertEquals(rrLmn1.change11_x().operation, _11_16_LMN);
		assertTrue(rrLmn1.change11_x().fb() != 0);

		var baUpdate3 = hexToRaw("EC07000001B18D0554E67CD90200000107D7CD51000000000501C6005600FFFFC970831554E67CD98D0500000100FFFF030000000000000012021400180010001D000400000000001C00FC01FC010A000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000030001001E001E001E00000005000000000000000100000000000000000001000700040007000600000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020007000500000000003C07D810220000005B00020089F336004C5404C31F9B02001F9B020007000000000000000B010203000089F3020D000000000000347083154C540500D543C1033203C0037D092501080000000408BD000000FF0200000300000000007E007F000144FE000900DA00DA00000000107CD940000000D543C103010000005C005D005E005F0060006100620063006400650066006700680069006A006B006C006D006E006F0070007100720073007400750076007700780079007A007B007C007D007E007F0080008100820083008400850086008700880089008A008B008C008D008E008F0090009100920093009400950096009700980099009A009B009C009D009E009F00A000A100A200A300A400A500A600A700A800A900AA00AB00AC00AD00AE00AF00B000B100B200B300B400B500B600B700B800B900BA00BB00BC00BD00BE00BF00C000C100C200C300C400C500C600C700C800C900CA00CB00CC00CD00CE00CF00D000D100D200D300D400D500D600D700D800D900DC00DD00DE00DF00E000E100E200E300E400E500E600E700E800E900EA00EB00EC00ED00EE00EF00F000F100F200F300F400F500F600F700F800F900FA00FB00FC00FD00FE00FF0000010101020103010401050106010701080109010A010B010C010D010E010F0110011101120113011401150116011701180119011A011B011C011D011E011F0120012101220123012401250126012701280129012A012B012C012D012E012F0130013101320133013401350136013701380139013A013B013C013D013E013F0140014101420143014401450146014701480149014A014B014C014D014E014F0150015101520153015401550156015701580159015A015B010A00FFFFFFFFFFFFFFFFFFFFFFFF0500FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0200FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF030001001E001E001E00FFFF0500FFFFFFFFFFFF0100FFFFFFFFFFFFFFFF01000700040007000600FFFFFFFF0200FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0100FFFFFFFFFFFF0300FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF020007000500FFFF34393030323834363231245FC408333D05000000434145173236310030B1B60820202020202020202020202020202020202020202020202020202020203100002020202020202020202020202020202020202020202020202020202020300200202020202020202020202020202020202020202020202020202020202030020030303234300D00005300000080374517787D0B1C0D253C08C3023750787D0B1C182E0900C5023011611A0B01C1540000599D7CD9C2033E1CC102CD51787D0B140B391805C41B03543D0500150B05010019000200D543C10354E67CD98D05000001001F9B03000000000000000C0010001D00040000000000020D000000000000C97083154C540400D543C1033203C0037D090501080000000408BD000000FF0200000300000000007E007F00");
		var rrUpdate3 = new OraCdcRedoRecord(orl, 0x0000058dd97ce654l, "0x0042c9.007145eb.00e8", baUpdate3);
		assertTrue(rrUpdate3.has5_1());
		assertTrue(rrUpdate3.change5_1().supplementalLogData());
		assertTrue(rrUpdate3.change5_1().supplementalFb() != 0);
		assertTrue(rrUpdate3.change5_1().fb() != 0);
		assertFalse(rrUpdate3.has10_x());
		assertTrue(rrUpdate3.has11_x());
		assertEquals(rrUpdate3.change11_x().operation, _11_5_URP);
		assertTrue(rrUpdate3.change11_x().fb() != 0);

		assertEquals(rrLmn1.halfDoneKey(), rrUpdate3.halfDoneKey());

		var raw = new OraCdcRawTransaction(new Xid((short)0x5b, (short)0x2, 0x36f389), ZoneId.systemDefault(), 0x10, new OraCdcLobExtras());
		try {
			raw.add(rrUpdate1, (int)(System.currentTimeMillis() / 1000));
			raw.add(rrUpdate2, (int)(System.currentTimeMillis() / 1000));
			raw.add(rrLmn1, (int)(System.currentTimeMillis() / 1000));
			raw.add(rrUpdate3, (int)(System.currentTimeMillis() / 1000));
			raw.commitScn(0x0000058dd7ec0179l);
			var transaction = new OraCdcTransactionArrayList(raw, orl.cdb(), REDOMINER, Path.of(System.getProperty("java.io.tmpdir")));
			var stmt = new OraCdcRedoMinerStatement();

			assertTrue(transaction.completed());

			assertTrue(transaction.getStatement(stmt));
			assertEquals(stmt.getOperation(), UPDATE);
			assertEquals(stmt.getRba(), rrUpdate1.rba());
			assertEquals(stmt.getRowId().toString(), "AAApsfAAQAAAQD/AAR");
			System.out.println(stmt);

			assertTrue(transaction.getStatement(stmt));
			assertEquals(stmt.getOperation(), UPDATE);
			assertEquals(stmt.getRba(), rrLmn1.rba());
			assertEquals(stmt.getRowId().toString(), "AAApsfAAPAAAUPVAAB");
			System.out.println(stmt);


		} catch(IOException | SQLException e) {}
	}

	@Test
	public void testOeOrderLinesAll() {

		var orl = OraCdcRedoLog.getLinux19c();

		/*
		XID:0x007a.01a.00186e2f, SCN:6106771095369, RBA:0x0042bf.0075411c.0158, OP:5.1 fb:--H-F---, supp fb:----F---, OP:11.5 fb:--H-F---
		XID:0x007a.01a.00186e2f, SCN:6106771095369, RBA:0x0042bf.00754120.00e0, OP:5.1 fb:-----L--, supp fb:-C---L--, OP:11.5 fb:-----L--
		 */
		var baUpdate1 = hexToRaw("58060000010D8D0549FFEBD70700000307D7CD5100002608050104015D00FFFFC6C641173FFFEBD78D0500000400FFFF0300000000000000E2001400180010002900CC0005000300020009000700070000000200030002000100000003000000000000000000010000000000030003000300000000000000000000000000020004000A0001000100000000000000000000000000000000000000050007000000000000000000030007000200000000001C000B0004000A00000003000300000000000A00000003000000000000000000000003000300010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001C00040004000500020000001803C408220000007A001A002F6E1800B5E03A12DBA70200DBA702000E000000000000000B011A3900002F6E020D000000000000C2C64117B5E0260038FD8D1732D4C4087D092501010000002801030001006866F8FF40E88D1FFCE731647DFCFFFF3F00006C4203020003000400050006000700080009000A000B000C000D000E000F0010001100120013001400150016001700180019001A001B001C001D001E001F0020002100220023002400250026002700280029002A002B002C002D002E002F0030003100320033003400350036003700380039003A003B003C003D003E003F0040004100420043004400450046004700480049004A004B004C004D004E004F0050005100520053005400550056005700580059005A005B005C005D005E005F0060006100620063006400650066006700C4112106306C4203C20B0200C1022608353932323730363837000000787D0C0D01010101787D0C0D01010102454105C4C215111D45413B3680C50C1CC215110053188848C2033E06C2452100C2422A05C154EBD7C307294834353833373632373535AE008000FFFF806C4203C4044A5A59050000787D0C0D01010100C23D0600787D0B1B09372600C10202003030303030315F554E53504543494649455F4C5F5354414E44415244554E53504543494649454400506169645348495020504F494E540000C20D16033E63660034353833373632373535250130303100C1076300C107630180000000010802002E00030003000000001000000000000038FD8D17010000000100020005000200C41B101D56C82608C154EBD70B0501005E00020038FD8D1738FDEBD78D0500000200DBA70300000000000000D40010002900CC0005000300020009000700070007000200030002000100000003000000000000000100010000000000030003000300000000000000000000000000020004000A0001000100000000000000000000000000000000000000050007000000000000000000030007000200000000001C000B0004000A00000003000300000000000A0000000300000000000000000000000300030001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020D8900D07F0000C6C64117B5E03A0038FD8D1732D4C4087D090501010000002801030001006866080000E88C1FFCE731647DFCFFFF3F0000000000020003000400050006000700080009000A000B000C000D000E000F0010001100120013001400150016001700180019001A001B001C001D001E001F0020002100220023002400250026002700280029002A002B002C002D002E002F0030003100320033003400350036003700380039003A003B003C003D003E003F0040004100420043004400450046004700480049004A004B004C004D004E004F0050005100520053005400550056005700580059005A005B005C005D005E005F0060006100620063006400650066006700C41121063091C408C20B0201C1020000353932323730363837000000787D0C0D010101AC787D0C0D01010100787D0C0C183C010045410000C21511004541010080000200C215110880CDEBD753050000C2033EA0C2452100C2422A00C1541000C3072948343538333736323735350000806C420380452700C4044A5A5991C408787D0C0C183C0100C23D0600787D0B1B09372600C10218883030303030315F554E53504543494649455F4C5F5354414E44415244554E535045434946494544FF506169645348495020504F494E54FFFFC20D16003E63660034353833373632373535020030303100C107630DC107630080000D00");
		var rrUpdate1 = new OraCdcRedoRecord(orl, 0x0000058dd7ebff49l, "0x0042bf.0075411c.0158", baUpdate1);
		assertTrue(rrUpdate1.has5_1());
		assertTrue(rrUpdate1.change5_1().supplementalLogData());
		assertTrue(rrUpdate1.change5_1().supplementalFb() != 0);
		assertTrue(rrUpdate1.change5_1().fb() != 0);
		assertFalse(rrUpdate1.has10_x());
		assertTrue(rrUpdate1.has11_x());
		assertEquals(rrUpdate1.change11_x().operation, _11_5_URP);
		assertTrue(rrUpdate1.change11_x().fb() != 0);

		var baUpdate2 = hexToRaw("F80A000001CD8D0549FFEBD7080000FF07D7CD5100000000050104015D00FFFFC6C6411749FFEBD78D0500000100FFFF030000000000000012021400180010003B00E6010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000700030007000300060003000400070006000000000000000000000000000800000001000100000005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007000000000000000000080001000100010003000000000000000000000000000000000005000400000000000100000000000000000000000000020013000000030000000300000000000000000000000000000000000000000000000000000000000000000000000000010000000000000001000000010006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000002000000030003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001001C001A001A00000000000000000000000000000000000000000000000100000000008005AA05220000007A001A002F6E1800B5E03B12DBA70200DBA702000E000000000000000B011A3A00002F6E020D000000000000C6C64117B5E03A0038FD8D1732D4C4087D09250101000000040103000000FFF3EFFFFFFFFFFFFFFF07F04BFFFF7F0FFED94FFDFFEFF2FFFFFD2FFFFFBFFFFFFF0300710100000100020003000400050006000700080009000A000B000C000D000E000F0010001100120013001400150016001700180019001A001B001C001D001E001F0020002100220023002400250026002700280029002A002B002C002D002E002F0030003100320033003400350036003700380039003A003B003C003D003E003F0040004100420043004400450046004700480049004A004B004C004D004E004F0050005100520053005400550056005700580059005A005B005C005E005F0060006100620063006400650066006700680069006A006B006C006D006E006F0070007100720073007400750076007700780079007A007B007C007D007E007F00810082008300840085008600870088008A008B008C008D008E008F0090009100920093009400950096009700980099009A009B009C009D009E009F00A000A100A200A300A400A500A600A700A800A900AA00AB00AC00AD00AE00AF00B000B100B200B300B400B700B800B900BA00BB00BC00BD00BE00BF00C000C100C200C300C400C500C600C700C800C900CA00CB00CC00CD00CE00CF00D000D100D200D300D400D500D600D700D800DA00DB00DC00DD00DF00E000E100E200E300E400E500E700E800E900EA00EB00EC00ED00EE00EF00F000F100F200F300F800F900FA00FB00FC00FD00FE001400787D0B1B09372700C2342800787D0B1B09372D00C2342800C502300D57452D22C2073D00C3045F2B787D0B1B09372100C5022D5E1C29C81C5354414E444152444E6C42034E452C004F5244455291C408787E0C0D01010100494E5445524E414C4E00000059085803590000183E626600C40264182F000400435553544E100000C1070000323032353131323720303834373138202B2E3100303031A0C107630080000000590010004E000200424F4F4B4544000059000000C1044203C1076300C10763084691C4084E09050101440D002E00690069000000001000000000000038FD8D1701000000C600E900F2001E011F01420147014F015D015E015F0160016801AE00FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0100FFFF0000800014000B0501005E00020038FD8D1749FFEBD78D0500000100DBA70300000000000000EE0110003B00E6010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000700030007000300060003000400070006000000000000000000000000000800000001000100010005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007000000070000000900080001000100010003000000000000000000000000000000000005000400000000000100000000000000000000000000020013000000030000000300000000000000000000000000000000000000000000000000000000000000000000000000010000000000000001000000010006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000002000000030003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000020D010000000000C6C64117B5E03B0038FD8D1732D4C4087D09050101000000040103000000FFF31100FFFFFFFFFFFF07F00BFFFF7F05FED94FFDFFEFF2FFFFFD2FFFFFBFFFFFFF0300710000000100020003000400050006000700080009000A000B000C000D000E000F0010001100120013001400150016001700180019001A001B001C001D001E001F0020002100220023002400250026002700280029002A002B002C002D002E002F0030003100320033003400350036003700380039003A003B003C003D003E003F0040004100420043004400450046004700480049004A004B004C004D004E004F0050005100520053005400550056005700580059005A005B005C005E005F0060006100620063006400650066006700680069006A006B006C006D006E006F0070007100720073007400750076007700780079007A007B007C007D007E007F00810082008300840085008600870088008A008B008C008D008E008F0090009100920093009400950096009700980099009A009B009C009D009E009F00A000A100A200A300A400A500A600A700A800A900AA00AB00AC00AD00AE00AF00B000B100B200B300B400B700B800B900BA00BB00BC00BD00BE00BF00C000C100C200C300C400C500C600C700C800C900CA00CB00CC00CD00CE00CF00D000D100D200D300D400D500D600D700D800DA00DB00DC00DD00DF00E000E100E200E300E400E500E700E800E900EA00EB00EC00ED00EE00EF00F000F100F200F300F800F900FA00FB00FC00FD00FE000B01787D0B1B09372704C2342805787D0B1B09373000C2342805C502300D57450006C2073D51C3045F2B787D0B1B093721FFC5022D5E1C29EBD75354414E444152444E0000004E000000590014004F52444552000200787E0C0D01010109787D0C0C183C01005343484544554C4544A00200494E5445524E414C4E00000059010D315900C81C3E626600C40264182F6C4203435553544EC82608C107C408323032353131323720303834373138202B2E310030303112C107631380137613591C00004E000400424F4F4B4544000059000000C1050100C1076300C107630846CDEBD74E050000");
		var rrUpdate2 = new OraCdcRedoRecord(orl, 0x0000058dd7ebff49l, "0x0042bf.00754120.00e0", baUpdate2);
		assertTrue(rrUpdate2.has5_1());
		assertTrue(rrUpdate2.change5_1().supplementalLogData());
		assertTrue(rrUpdate2.change5_1().supplementalFb() != 0);
		assertTrue(rrUpdate2.change5_1().fb() != 0);
		assertFalse(rrUpdate2.has10_x());
		assertTrue(rrUpdate2.has11_x());
		assertEquals(rrUpdate2.change11_x().operation, _11_5_URP);
		assertTrue(rrUpdate2.change11_x().fb() != 0);

		assertEquals(rrUpdate1.halfDoneKey(), rrUpdate2.halfDoneKey());

		/*
		XID:0x007a.01a.00186e2f, SCN:6106771095487, RBA:0x0042bf.00754b69.00cc, OP:5.1 fb:----F---, supp fb:----F---, OP:11.16 fb:----F---
		XID:0x007a.01a.00186e2f, SCN:6106771095487, RBA:0x0042bf.00754b6b.0170, OP:5.1 fb:-----L--, supp fb:-C---L--, OP:11.5 fb:-----L--
		 */
		var baLmn1 = hexToRaw("8404000001008D05BFFFEBD70D00000007D7CD5100000000050104015D00FFFFCAC64117BFFFEBD78D0500000500FFFF0300000000000000E00014001800100010001C00D000D0000500020005000300020009000700070007000200030002000100000003000000000000000100010000000000030003000300000000000000000000000000020004000A0001000100000000000000000000000000000000000000050007000000000000000000030007000200000000001C000B0004000A00000003000300000000000A0000000300000000000000000000000300030001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000D4036217220000007A001A002F6E1800B5E00700DBA70200DBA702000E000000000000000B011A0600002F6E020D95450F000000C6C64117B5E03B0038FD8D1732D4C4087D09300101000000010868002E00000000000000001000004000000038FD8D17010000000100020003000400050006000700080009000A000B000C000D000E000F0010001100120013001400150016001700180019001A001B001C001D001E001F0020002100220023002400250026002700280029002A002B002C002D002E002F0030003100320033003400350036003700380039003A003B003C003D003E003F0040004100420043004400450046004700480049004A004B004C004D004E004F0050005100520053005400550056005700580059005A005B005C005D005E005F006000610062006300640065006600670068000500020005000300020009000700070007000200030002000100FFFF0300FFFFFFFFFFFF01000100FFFFFFFF030003000300FFFFFFFFFFFFFFFFFFFFFFFF020004000A0001000100FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF05000700FFFFFFFFFFFFFFFF030007000200FFFFFFFF1C000B0004000A00FFFF03000300FFFFFFFF0A00FFFF0300FFFFFFFFFFFFFFFFFFFF030003000100FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC41B101D56D2EBD7C1540000C411210630000000C20B0200C10210003539323237303638370D0000787D0C0D01010117787D0C0D01010108787D0C0C183C010145410000C215110045410B0180000000C21511008000000053000000C2033E00C2452105C2422AD7C1540000C307294834353833373632373535FFFF80B6441780D2EBD7C4044A5A5900FFFF787D0C0C183C0100C23D0600787D0B1B09372600C10214003030303030315F554E53504543494649455F4C5F5354414E44415244554E5350454349464945440B506169645348495020504F494E544417C20D16003E63660834353833373632373535000030303100C1076301C1076300800000000B1001005E00020038FD8D1749FFEBD78D0500000200DBA703000000000000000800100010001C00020D7105D07F0000CAC64117B5E0070038FD8D1732D4C4087D09100101000000010800002E00000000000000001000004000000038FD8D1701000000");
		var rrLmn1 = new OraCdcRedoRecord(orl, 0x0000058dd7ebffbfl, "0x0042bf.00754b69.00cc", baLmn1);
		assertTrue(rrLmn1.has5_1());
		assertTrue(rrLmn1.change5_1().supplementalLogData());
		assertTrue(rrLmn1.change5_1().supplementalFb() != 0);
		assertTrue(rrLmn1.change5_1().fb() != 0);
		assertFalse(rrLmn1.has10_x());
		assertTrue(rrLmn1.has11_x());
		assertEquals(rrLmn1.change11_x().operation, _11_16_LMN);
		assertTrue(rrLmn1.change11_x().fb() != 0);

		var baUpdate3 = hexToRaw("2C08000001078D05BFFFEBD70E00000007D7CD5100000000050104015D00FFFFCAC64117BFFFEBD78D0500000600FFFF030000000000000012021400180010001D000C000700030006000100020000001C00F401F4010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000700030003000400070006000000000000000000000000000800000001000100010005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000700000007000000090008000100010001000300000000000000000000000000000000000500040000000000000000000000000000000000020013000000000003000000030000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000010000000100060000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000030003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000001000000000050078C13220000007A001A002F6E1800B5E00800DBA70200DBA702000E000000000000000B011A0700002F6E020D000000000000C6C64117B5E03B0038FD8D1732D4C4087D09250101000000040100000000FF0600002000000002003500360037007600C100DA00787D0B1B09373000C2342822C502300D574502004E000000C10500000144FA002E009E009E000000001000000000000038FD8D170100000069006A006B006C006D006E006F0070007100720073007400750076007700780079007A007B007C007D007E007F0080008100820083008400850086008700880089008A008B008C008D008E008F0090009100920093009400950096009700980099009A009B009C009D00A100A200A300A400A500A600A700A800A900AA00AB00AC00AD00AE00AF00B000B100B200B300B400B500B600B700B800B900BA00BB00BC00BD00BE00BF00C000C100C200C300C400C500C600C700C800C900CA00CB00CC00CD00CE00CF00D000D100D200D300D400D500D600D700D800D900DA00DB00DC00DD00DE00E000E100E200E300E400E500E600E700E800E900EA00EB00EC00ED00EE00EF00F000F100F200F300F400F500F600F700F800F900FA00FB00FC00FD00FE00FF0000010101020103010401050106010701080109010A010B010C010D010E010F0110011101120113011401150116011701180119011A011B011C011D011E011F0120012101220123012401250126012701280129012B012C012D012E012F0130013101320133013401350136013701380139013A013B013C013D013E013F014001410142014401450146014701480149014A014B014C014D014E014F0150015101520153015401550156015701580159015A015B015C015D015E015F01600161016201630164016501660167016801FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF070003000300040007000600FFFFFFFFFFFFFFFFFFFFFFFF0800FFFF0100010001000500FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0700FFFF0700FFFF090008000100010001000300FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF05000400FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF02001300FFFFFFFF0300FFFF0300FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0100FFFFFFFFFFFF0100FFFF01000600FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0100FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF03000300FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0100FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0100FFFFFFFFFFFFFFFFFFFFFFFF0100FFFF787D0B1B09372700C2342800C2073D01C3045F2B787D0B1B09372100C5022D5E1C2900005354414E444152444E0A00004ED7CD51590000004F5244455200FFFF787E0C0D010101D7787D0C0C183C01FF5343484544554C4544001400494E5445524E414C4E00140059008A17590000003E626600C40264182F3F132243555354C1070200323032353131323720303834373138202B2E310030303100C1076317803F120059C826084E91C408424F4F4B4544000059000000C1076301C107630046C0A65D800000004E0000000B0501005E00020038FD8D17BFFFEBD78D0500000100DBA70300000000000000140010001D000C00070003000600010002000000020D000001000000CAC64117B5E0080038FD8D1732D4C4087D09050101000000040100000000FF0600002000000700003500360037007600C100DA00787D0B1B093731FFC2342800C502300D5745EBD7590A00FFC106CD51");
		var rrUpdate3 = new OraCdcRedoRecord(orl, 0x0000058dd7ebffbfl, "0x0042bf.00754b6b.0170", baUpdate3);
		assertTrue(rrUpdate3.has5_1());
		assertTrue(rrUpdate3.change5_1().supplementalLogData());
		assertTrue(rrUpdate3.change5_1().supplementalFb() != 0);
		assertTrue(rrUpdate3.change5_1().fb() != 0);
		assertFalse(rrUpdate3.has10_x());
		assertTrue(rrUpdate3.has11_x());
		assertEquals(rrUpdate3.change11_x().operation, _11_5_URP);
		assertTrue(rrUpdate3.change11_x().fb() != 0);

		assertEquals(rrLmn1.halfDoneKey(), rrUpdate3.halfDoneKey());

		var raw = new OraCdcRawTransaction(new Xid((short)0x7a, (short)0x1a, 0x186e2f), ZoneId.systemDefault(), 0x10, new OraCdcLobExtras());
		try {
			raw.add(rrUpdate1, (int)(System.currentTimeMillis() / 1000));
			raw.add(rrUpdate2, (int)(System.currentTimeMillis() / 1000));
			raw.add(rrLmn1, (int)(System.currentTimeMillis() / 1000));
			raw.add(rrUpdate3, (int)(System.currentTimeMillis() / 1000));
			raw.commitScn(0x0000058dd7ec0179l);
			var transaction = new OraCdcTransactionArrayList(raw, orl.cdb(), REDOMINER, Path.of(System.getProperty("java.io.tmpdir")));
			var stmt = new OraCdcRedoMinerStatement();

			assertTrue(transaction.completed());

			assertTrue(transaction.getStatement(stmt));
			assertEquals(stmt.getOperation(), UPDATE);
			assertEquals(stmt.getRba(), rrUpdate1.rba());
			assertEquals(stmt.getRowId().toString(), "AAAqfbABeAADf04AAB");
			System.out.println(stmt);

			assertTrue(transaction.getStatement(stmt));
			assertEquals(stmt.getOperation(), UPDATE);
			assertEquals(stmt.getRba(), rrLmn1.rba());
			assertEquals(stmt.getRowId().toString(), "AAAqfbABeAADf04AAB");
			System.out.println(stmt);


		} catch(IOException | SQLException e) {}
	}

		
}
